var apexScreenCapture={parseBoolean:function(e){var t;return"true"==e.toLowerCase()&&(t=!0),"false"==e.toLowerCase()&&(t=!1),"true"!=e.toLowerCase()&&"false"!=e.toLowerCase()&&(t=void 0),t},clob2Array:function(e,t,n){loopCount=Math.floor(e.length/t)+1;for(var a=0;a<loopCount;a++)n.push(e.slice(t*a,t*(a+1)));return n},dataURI2base64:function(e){return e.substr(e.indexOf(",")+1)},svg2canvas:function(e,t){try{var n,a;$(e).find("svg").each((function(){(n=document.createElement("canvas")).className="tempCanvas",$(this).attr("width",$(this).innerWidth()),$(this).attr("height",$(this).innerHeight()),a=(a=(new XMLSerializer).serializeToString(this)).replace(/xmlns=\"http:\/\/www\.w3\.org\/2000\/svg\"/,""),canvg(n,a),$(n).insertAfter(this),$(this).attr("class","tempHide"),$(this).hide()})),t()}catch(e){t()}},convertImage2PDF:function(e){const t=new jsPDF("p","mm","a4"),n=e.toDataURL("image/png"),a=e.width/e.height,o=t.internal.pageSize.getWidth()-20,r=t.internal.pageSize.getHeight()-20;let i,c,l,p;return a>o/r?(i=o,c=i/a):(c=r,i=c*a),l=(o-i)/2+10,p=(r-c)/2+10,t.addImage(n,"PNG",l,p,i,c,null,"NONE"),t},getImage:function(e,t,n,a,o,r){var i,c;i="application/pdf"===a?(c=apexScreenCapture.convertImage2PDF(t)).output("datauristring"):t.toDataURL(a);var l=o&&o.trim()?o.trim():"screencapture",p="application/pdf"===a?".pdf":"image/png"===a?".png":".jpg";if("D"===n){if("application/pdf"===a)c.save(l+p);else{var u=document.createElement("a");u.href=i,u.download=l+p,document.body.appendChild(u),u.click(),document.body.removeChild(u)}r()}if("T"===n)"application/pdf"===a?window.open(c.output("bloburl"),"_blank"):window.open().document.write('<img src="'+i+'" />'),r();else{var s=apexScreenCapture.dataURI2base64(i),d=[];d=apexScreenCapture.clob2Array(s,3e4,d),apex.server.plugin(e,{f01:d,x01:a},{dataType:"html",success:function(){$("body").trigger("screencapture-saved-db"),r()},error:function(e,t){$("body").trigger("screencapture-error-db"),console.log("getImage: apex.server.plugin ERROR:",t),r()}})}},doHtml2Canvas:function(e,t,n,a,o,r,i,c,l,p,u){p&&(console.log("doHtml2Canvas: HTML element:",e),console.log("doHtml2Canvas: element width:",o),console.log("doHtml2Canvas: element height:",r));var s=apex.util.showSpinner($("body"));s.attr("data-html2canvas-ignore","true"),apexScreenCapture.svg2canvas("body",(function(){html2canvas($(e),{onrendered:function(e){apexScreenCapture.getImage(n,e,t,l,u,(function(){s.remove()}))},useCORS:!0,background:a,width:o,height:r,letterRendering:i,allowTaint:c,logging:p}),$("body").find(".tempCanvas").remove(),$("body").find(".tempHide").show().removeClass("tempHide")}))},doHtml2CanvasDom:function(e,t,n,a,o,r,i,c,l){pWidth=$(e).width(),pHeight=$(e).height(),c&&(console.log("doHtml2CanvasDom: Clicked element:",e),console.log("doHtml2CanvasDom: element width:",pWidth),console.log("doHtml2CanvasDom: element height:",pHeight));var p=apex.util.showSpinner($("body"));p.attr("data-html2canvas-ignore","true"),apexScreenCapture.svg2canvas("body",(function(){html2canvas($(e),{onrendered:function(e){apexScreenCapture.getImage(n,e,t,i,l,(function(){p.remove()}))},useCORS:!0,background:a,width:pWidth,height:pHeight,letterRendering:o,allowTaint:r,logging:c}),$("body").find(".tempCanvas").remove(),$("body").find(".tempHide").show().removeClass("tempHide")}))},captureScreen:function(){var e,t,n,a=this,o=a.action.ajaxIdentifier,r=a.action.attribute01,i=a.action.attribute02,c=a.action.attribute04,l=parseInt(a.action.attribute05),p=parseInt(a.action.attribute06),u=apexScreenCapture.parseBoolean(a.action.attribute07),s=apexScreenCapture.parseBoolean(a.action.attribute08),d=apexScreenCapture.parseBoolean(a.action.attribute09),g=a.action.attribute10,m=a.action.attribute11,h=apexScreenCapture.parseBoolean(a.action.attribute12),b=apexScreenCapture.parseBoolean(a.action.attribute13),v=a.action.attribute14,f=a.action.attribute15;if("body"!==r?(t=parseInt($(r).innerWidth()),n=parseInt($(r).innerHeight())):(t=parseInt(document.documentElement.clientWidth),n=parseInt(document.documentElement.clientHeight)),l&&(t=l),p&&(n=p),null==m&&(m=!1),null==h&&(h=!1),null==b&&(b=!1),e="PNG"==f?"image/png":"JPEG"==f?"image/jpeg":"PDF"==f?"application/pdf":"image/png",d&&(console.log("captureScreen: Attribute JQuery selector:",r),console.log("captureScreen: Attribute open window:",i),console.log("captureScreen: Attribute background:",c),console.log("captureScreen: Attribute element width:",t),console.log("captureScreen: Attribute element height:",n),console.log("captureScreen: Attribute letter rendering:",u),console.log("captureScreen: Attribute allow taint:",s),console.log("captureScreen: Attribute Logging:",d),console.log("captureScreen: Attribute DOM selector:",g),console.log("captureScreen: Attribute DOM filter:",m),console.log("captureScreen: Attribute hide label:",h),console.log("captureScreen: Attribute fill content:",b),console.log("captureScreen: Attribute image mime-type:",e),console.log("captureScreen: Attribute Filename:",v)),"Y"==g){DomOutline({onClick:function(t){apexScreenCapture.doHtml2CanvasDom(t,i,o,c,u,s,e,d,v)},filter:m,stopOnClick:!0,borderColor:"#09c",hideLabel:h,fillContent:b}).start()}else apexScreenCapture.doHtml2Canvas(r,i,o,c,t,n,u,s,e,d,v)}};